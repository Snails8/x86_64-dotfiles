var ke=Object.create;var I=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var Ee=Object.getOwnPropertyNames;var Le=Object.getPrototypeOf,De=Object.prototype.hasOwnProperty;var V=a=>I(a,"__esModule",{value:!0});var Ae=(a,e)=>{for(var t in e)I(a,t,{get:e[t],enumerable:!0})},G=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ee(e))!De.call(a,n)&&(t||n!=="default")&&I(a,n,{get:()=>e[n],enumerable:!(r=Te(e,n))||r.enumerable});return a},l=(a,e)=>G(V(I(a!=null?ke(Le(a)):{},"default",!e&&a&&a.__esModule?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a),ze=(a=>(e,t)=>a&&a.get(e)||(t=G(V({}),e,1),a&&a.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var Me={};Ae(Me,{default:()=>Ie});var Se=l(require("yargs")),Re=l(require("concat-stream")),xe=require("vscode-oniguruma"),Ce=require("fs"),Fe=require("yargs/helpers");var be=l(require("ignore")),C=l(require("path")),$=l(require("fs")),c=l(require("process")),f=l(require("chalk")),Be=l(require("glob")),U=l(require("util")),g=l(require("lodash")),$e=l(require("find-config"));var ue=l(require("os")),j=l(require("js-beautify")),i=l(require("lodash")),Je=l(require("vscode-textmate")),B=l(require("detect-indent")),me=l(require("aigle")),H=l(require("xregexp"));var he=require("fs"),pe=l(require("lodash")),K=l(require("vscode-oniguruma")),de=l(require("path"));var y=l(require("lodash")),te=l(require("fs")),D=l(require("chalk")),A=l(require("prettier/standalone")),z=l(require("@prettier/plugin-php/standalone")),Oe=l(require("detect-indent"));var k=l(require("lodash")),v=["@alert","@push","@slot","@switch","@unless","@verbatim","@prepend","@once","@error","@empty","@guest","@isset","@permission","@permissions","@canany","@cannot","@can","@role","@hasrole","@hasanyrole","@hasallroles","@unlessrole","@hasexactroles","@if","@production","@env","@while","@auth","@forelse","@for","@foreach","@php","@component","@hassection","@section"],T=["@endalert","@endpush","@endslot","@endswitch","@endunless","@endverbatim","@show","@stop","@endprepend","@endonce","@enderror","@append","@overwrite","@endempty","@endguest","@endisset","@endpermission","@endpermissions","@endcanany","@endcannot","@endcan","@endrole","@endhasrole","@endhasanyrole","@endhasallroles","@endunlessrole","@endhasexactroles","@endif","@endproduction","@endenv","@endwhile","@endauth","@endforelse","@endfor","@endforeach","@endphp","@endcomponent","@endsection"],q=["@elseenv","@elseif","@elsecanany","@elsecannot","@elsecan","@else"],N={"@section":2,"@push":2,"@prepend":2,"@slot":2},Q=["@forelse"],X=["@empty"],Y=["@default"],E=["@forelse","@if","@for","@foreach","@while","@sectionmissing","@case"],L=["@endforelse","@endif","@endfor","@endforeach","@endwhile","@break"],J=["@json"],Z=["@if","@while","@case","@isset","@empty","@elseif"];function ee(a,e){return k.default.filter(a.tokens,t=>{let r=e.substring(t.startIndex,t.endIndex).trim();return k.default.includes(v,r)||k.default.includes(T,r)}).length>=2}var P="\\(((?:[^)(]+|\\((?:[^)(]+|\\((?:[^)(]+|\\((?:[^)(]+|\\([^)(]*\\))*\\))*\\))*\\))*)\\)";var w=a=>{let e={get(){return null}};return y.default.isUndefined(a)||y.default.isNull(a)?e:a};async function O(a){return new Promise((e,t)=>{te.default.readFile(a,(r,n)=>r?t(r):e(n))})}function R(a){return a?a.split(/\r\n|\n|\r/):""}function b(a){return A.default.format(a.replace(/\n$/,""),{parser:"php",printWidth:1e3,singleQuote:!0,phpVersion:"8.0",plugins:[z.default]})}function _(a,e=1e3,t=!0){return A.default.format(`<?php echo ${a} ?>`,{parser:"php",printWidth:e,singleQuote:!0,phpVersion:"8.0",trailingCommaPHP:t,plugins:[z.default]}).replace(/<\?php echo (.*)?\?>/gs,(r,n)=>n.trim().replace(/;\s*$/,""))}function ne(a){let e=`<?php tmp_func${a}; ?>`,{ast:t}=A.default.__debug.parse(e,{parser:"php",phpVersion:"8.0",plugins:[z.default]});try{return t.children[0].expression.arguments.length||0}catch{return 0}}function re(a){return Promise.all(y.default.map(a,async e=>{process.stdout.write(`path: ${D.default.bold(e.path)}:${e.line}
`),process.stdout.write(D.default.red(`--${e.original}
`)),process.stdout.write(D.default.green(`++${e.formatted}
`))}))}function ie(a,e,t){let r=y.default.map(e,(n,s)=>y.default.isEmpty(n)||n===t[s]?null:{path:a,line:s+1,original:n,formatted:t[s]});return y.default.without(r,null)}async function je(a){let e=y.default.without(v,"@switch","@forelse","@php").join("|"),t=new RegExp(`(?!\\/\\*.*?\\*\\/)(${e})(\\s*?)${P}`,"gmi");return new Promise(r=>r(a)).then(r=>y.default.replace(r,t,(n,s,o,h)=>b(`<?php ${s.substr("1")}${o}(${h}) ?>`).replace(/<\?php\s(.*?)(\s*?)\((.*?)\);*\s\?>\n/gs,(u,p,m,d)=>`@${p.trim()}${m}(${d.trim()})`).replace(/([\n\s]*)->([\n\s]*)/gs,"->"))).then(r=>b(r))}async function se(a){return je(a)}function ae(a){return new Promise(e=>e(a)).then(e=>{let t=new RegExp(`(${E.join("|")})([\\s]*?)${P}`,"gis");return y.default.replace(e,t,(r,n,s,o)=>`<beautifyTag start="${n}${s}" exp="^^^${y.default.escape(o)}^^^">`)}).then(e=>{let t=new RegExp(`(?!end=".*)(${L.join("|")})(?!.*")`,"gi");return y.default.replace(e,t,(r,n)=>`</beautifyTag end="${n}">`)})}function oe(a){return new Promise(e=>e(a)).then(e=>y.default.replace(e,/<beautifyTag.*?start="(.*?)".*?exp=".*?\^\^\^(.*?)\^\^\^.*?"\s*>/gs,(t,r,n)=>`${r}(${y.default.unescape(n)})`)).then(e=>y.default.replace(e,/<\/beautifyTag.*?end="(.*?)"\s*>/gs,(t,r)=>`${r}`))}var We=["/\\*\\* phptag_start \\*\\*/","/\\*\\* end_phptag \\*\\*/","/\\*escaped\\*/","__BLADE__;","/\\* blade_comment_start \\*/","/\\* blade_comment_end \\*/","beautifyTag"];function le(a){if(new RegExp(We.join("|")).test(a))throw new Error(["Can't format blade: something goes wrong.","Please check if template is too complicated or not. Or simplify template might solves issue."].join(`
`));return a}var M=class{constructor(e,t){return(async()=>{var r;return this.vsctm=(r=e.default)!=null?r:e,this.oniguruma=t||K.default||K,await this.loadWasm(),this})()}async loadWasm(){var t;let e=await he.promises.readFile(require.resolve("vscode-oniguruma/release/onig.wasm"));if(await((t=this.oniguruma)==null?void 0:t.loadWASM(e.buffer)),!this.initCalled){try{this.oniguruma.loadWASM(e.buffer)}catch{this.initCalled=!0}this.initCalled=!0}}createRegistry(){return this.registry=new this.vsctm.Registry({loadGrammar:e=>e==="text.html.php.blade"?O(de.default.resolve(__dirname,"../syntaxes/blade.tmLanguage.json")).then(t=>this.vsctm.parseRawGrammar(t.toString(),"./blade.tmLanguage.json")):null,onigLib:Promise.resolve({createOnigScanner:e=>new this.oniguruma.OnigScanner(e),createOnigString:e=>new this.oniguruma.OnigString(e)})}),this.registry}tokenizeLines(e,t){return pe.default.map(e,r=>{var n;return t.tokenizeLine(r,(n=this.vsctm)==null?void 0:n.INITIAL)})}};var x=class{constructor(e){this.options=e,this.vsctm=w(this.options).vsctm||Je,this.oniguruma=w(this.options).oniguruma,this.indentCharacter=w(this.options).useTabs?"	":" ",this.indentSize=w(this.options).indentSize||4,this.wrapLineLength=w(this.options).wrapLineLength||120,this.wrapAttributes=w(this.options).wrapAttributes||"auto",this.currentIndentLevel=0,this.shouldBeIndent=!1,this.isInsideCommentBlock=!1,this.stack=[],this.ignoredLines=[],this.curlyBracesWithJSs=[],this.rawBlocks=[],this.rawPhpTags=[],this.inlineDirectives=[],this.conditions=[],this.inlinePhpDirectives=[],this.rawPropsBlocks=[],this.bladeDirectives=[],this.bladeComments=[],this.bladeBraces=[],this.rawBladeBraces=[],this.scripts=[],this.classes=[],this.templatingStrings=[],this.result=[],this.diffs=[]}formatContent(e){return new Promise(t=>t(e)).then(t=>this.preserveIgnoredLines(t)).then(t=>this.preserveCurlyBraceForJS(t)).then(t=>this.preserveRawPhpTags(t)).then(t=>se(t)).then(t=>this.preserveBladeComment(t)).then(t=>this.preserveBladeBrace(t)).then(t=>this.preserveRawBladeBrace(t)).then(t=>this.preserveConditions(t)).then(t=>this.preserveInlineDirective(t)).then(t=>this.preserveInlinePhpDirective(t)).then(t=>this.breakLineBeforeAndAfterDirective(t)).then(t=>this.preserveBladeDirectivesInScripts(t)).then(async t=>(this.bladeDirectives=await this.formatPreservedBladeDirectives(this.bladeDirectives),t)).then(t=>this.preserveScripts(t)).then(t=>this.preserveClass(t)).then(t=>this.formatAsHtml(t)).then(t=>this.formatAsBlade(t)).then(t=>this.restoreClass(t)).then(t=>this.restoreScripts(t)).then(t=>this.restoreBladeDirectivesInScripts(t)).then(t=>this.restoreInlinePhpDirective(t)).then(t=>this.restoreInlineDirective(t)).then(t=>this.restoreConditions(t)).then(t=>this.restoreRawBladeBrace(t)).then(t=>this.restoreBladeBrace(t)).then(t=>this.restoreBladeComment(t)).then(t=>this.restoreRawPhpTags(t)).then(t=>this.restoreCurlyBraceForJS(t)).then(t=>this.restoreIgnoredLines(t)).then(t=>le(t))}formatAsHtml(e){let t={indent_size:w(this.options).indentSize||4,wrap_line_length:w(this.options).wrapLineLength||120,wrap_attributes:w(this.options).wrapAttributes||"auto",end_with_newline:w(this.options).endWithNewline||!0},r=new Promise(n=>n(e)).then(n=>this.preservePhpBlock(n)).then(n=>ae(n)).then(n=>j.default.html_beautify(n,t)).then(n=>oe(n)).then(n=>this.restorePhpBlock(n));return Promise.resolve(r)}async preserveIgnoredLines(e){return i.default.chain(e).replace(/(^(?<!.+)^{{--\s*blade-formatter-disable\s*--}}.*?)([\r\n]*)$(?![\r\n])/gis,(t,r,n)=>this.storeIgnoredLines(`${r}${n.replace(/^\n/,"")}`)).replace(/{{--\s*?blade-formatter-disable\s*?--}}.*?{{--\s*?blade-formatter-enable\s*?--}}/gis,t=>this.storeIgnoredLines(t)).replace(/{{--\s*?blade-formatter-disable-next-line\s*?--}}[\r\n]+[^\r\n]+/gis,t=>this.storeIgnoredLines(t)).value()}async preserveCurlyBraceForJS(e){return i.default.replace(e,/@{{(.*?)}}/gs,(t,r)=>this.storeCurlyBraceForJS(r))}async preservePhpBlock(e){return this.preserveRawPhpBlock(e).then(t=>this.preservePropsBlock(t))}async preservePropsBlock(e){return i.default.replace(e,/@props\(((?:[^\\(\\)]|\([^\\(\\)]*\))*)\)/gs,(t,r)=>this.storeRawPropsBlock(r))}async preserveRawPhpBlock(e){return i.default.replace(e,/(?<!@)@php(.*?)@endphp/gs,(t,r)=>this.storeRawBlock(r))}preserveInlineDirective(e){let t=new RegExp(`(<[\\w]+?[^>]*?)(${v.join("|")})(\\s*?)(${P})(.*?)(${T.join("|")})(.*?>)`,"gims"),r=i.default.replace(e,t,(n,s,o,h,u,p,m,d,F)=>`${s}${this.storeInlineDirective(`${o.trim()}${h}${u.trim()} ${m.trim()} ${d.trim()}`)}${F}`);return t.test(r)?this.preserveInlineDirective(r):r}async preserveInlinePhpDirective(e){return i.default.replace(e,new RegExp(`(?!\\/\\*.*?\\*\\/)(@php|@class|@button|@json)(\\s*?)${P}`,"gms"),t=>this.storeInlinePhpDirective(t))}preserveBladeDirectivesInScripts(e){return i.default.replace(e,/<script(.*?)>(.*?)<\/script>/gis,(t,r,n)=>{let s=[...v,...J];if(new RegExp(s.join("|"),"gmi").test(n)===!1)return`<script${r}>${n}<\/script>`;let o=J.join("|"),h=new RegExp(`(?!\\/\\*.*?\\*\\/)(${o})(\\s*?)${P}`,"gmi");n=i.default.replace(n,h,p=>this.storeBladeDirective(_(p)));let u=i.default.chain(v).without("@switch","@forelse","@empty").map(p=>i.default.replace(p,/@/,"")).value();return i.default.forEach(u,p=>{try{let m=H.default.matchRecursive(n,`\\@${p}`,`\\@end${p}`,"gmi",{valueNames:[null,"left","match","right"]}),d="";if(i.default.isEmpty(m))return;i.default.forEach(m,F=>{d+=F.value,F.name==="right"&&(n.includes(d)&&(n=i.default.replace(n,d,this.storeBladeDirective(d))),d="")})}catch{throw new Error("directive in scripts parsing error")}}),`<script${r}>${n}<\/script>`})}breakLineBeforeAndAfterDirective(e){let t=i.default.chain(v).map(r=>i.default.replace(r,/@/,"")).value();return i.default.forEach(t,r=>{try{let n=H.default.matchRecursive(e,`\\@${r}`,`\\@end${r}`,"gmi",{valueNames:[null,"left","match","right"]});if(i.default.isEmpty(n))return;for(let s of n)if(s.name==="match"){new RegExp(v.join("|")).test(s.value)&&(e=i.default.replace(e,s.value,this.breakLineBeforeAndAfterDirective(s.value)));let o=new RegExp(`^(\\s*?)${P}(.*)`,"gmis"),h=i.default.replace(`${s.value}`,o,(u,p,m,d)=>d.trim()===""?`${p}(${m.trim()})
${d.trim()}`:`${p}(${m.trim()})
${d.trim()}
`);e=i.default.replace(e,s.value,h)}}catch{}}),e}async preserveBladeComment(e){return i.default.replace(e,/\{\{--(.*?)--\}\}/gs,(t,r)=>this.storeBladeComment(r))}async preserveBladeBrace(e){return i.default.replace(e,/\{\{(.*?)\}\}/gs,(t,r)=>this.storeBladeBrace(r,r.length))}async preserveRawBladeBrace(e){return i.default.replace(e,/\{!!(.*?)!!\}/gs,(t,r)=>this.storeRawBladeBrace(r))}async preserveConditions(e){let t=new RegExp(`(${Z.join("|")})(\\s*?)${P}`,"gi");return i.default.replace(e,t,(r,n,s,o)=>`${n}${s}(${this.storeConditions(o)})`)}async preserveRawPhpTags(e){return i.default.replace(e,/<\?php(.*?)\?>/gms,t=>this.storeRawPhpTags(t))}async preserveScripts(e){return i.default.replace(e,/<script.*?>.*?<\/script>/gis,t=>this.storeScripts(t))}async preserveClass(e){return i.default.replace(e,/(\s*)class="(.*?)"(\s*)/gs,(t,r,n,s)=>`${r}class="${this.storeClass(n)}"${s}`)}storeIgnoredLines(e){return this.getIgnoredLinePlaceholder(this.ignoredLines.push(e)-1)}storeCurlyBraceForJS(e){return this.getCurlyBraceForJSPlaceholder(this.curlyBracesWithJSs.push(e)-1)}storeRawBlock(e){return this.getRawPlaceholder(this.rawBlocks.push(e)-1)}storeInlineDirective(e){return this.getInlinePlaceholder(this.inlineDirectives.push(e)-1,e.length)}storeConditions(e){return this.getConditionPlaceholder(this.conditions.push(e)-1)}storeInlinePhpDirective(e){return this.getInlinePhpPlaceholder(this.inlinePhpDirectives.push(e)-1)}storeRawPropsBlock(e){return this.getRawPropsPlaceholder(this.rawPropsBlocks.push(e)-1)}storeBladeDirective(e){return this.getBladeDirectivePlaceholder(this.bladeDirectives.push(e)-1)}storeBladeComment(e){return this.getBladeCommentPlaceholder(this.bladeComments.push(e)-1)}storeBladeBrace(e,t){let r=this.bladeBraces.push(e)-1,n="{{  }}";return this.getBladeBracePlaceholder(r,t+n.length)}storeRawBladeBrace(e){let t=this.rawBladeBraces.push(e)-1;return this.getRawBladeBracePlaceholder(t)}storeRawPhpTags(e){let t=this.rawPhpTags.push(e)-1;return this.getRawPhpTagPlaceholder(t)}storeScripts(e){let t=this.scripts.push(e)-1;return this.getScriptPlaceholder(t)}storeClass(e){let t=this.classes.push(e)-1;return e.length>0?this.getClassPlaceholder(t,e.length):this.getClassPlaceholder(t,null)}storeTemplatingString(e){let t=this.templatingStrings.push(e)-1;return this.getTemplatingStringPlaceholder(t)}getIgnoredLinePlaceholder(e){return i.default.replace("___ignored_line_#___","#",e)}getCurlyBraceForJSPlaceholder(e){return i.default.replace("___js_curly_brace_#___","#",e)}getRawPlaceholder(e){return i.default.replace("@__raw_block_#__@","#",e)}getInlinePlaceholder(e,t=0){if(t>0){let n=t-"___inline_directive_#___".length;return i.default.replace(`___inline_directive_${i.default.repeat("_",n>0?n:0)}#___`,"#",e)}return i.default.replace("___inline_directive_+?#___","#",e)}getConditionPlaceholder(e){return i.default.replace("___directive_condition_#___","#",e)}getInlinePhpPlaceholder(e){return i.default.replace("___inline_php_directive_#___","#",e)}getRawPropsPlaceholder(e){return i.default.replace("@__raw_props_block_#__@","#",e)}getBladeDirectivePlaceholder(e){return i.default.replace("___blade_directive_#___","#",e)}getBladeCommentPlaceholder(e){return i.default.replace("___blade_comment_#___","#",e)}getBladeBracePlaceholder(e,t=0){if(t>0){let n=t-"___blade_brace_#___".length;return i.default.replace(`___blade_brace_${i.default.repeat("_",n>0?n:0)}#___`,"#",e)}return i.default.replace("___blade_brace_+?#___","#",e)}getRawBladeBracePlaceholder(e){return i.default.replace("___raw_blade_brace_#___","#",e)}getRawPhpTagPlaceholder(e){return i.default.replace("___raw_php_tag_#___","#",e)}getScriptPlaceholder(e){return i.default.replace("___scripts_#___","#",e)}getClassPlaceholder(e,t){if(t&&t>0){let n=t-"___class_#___".length;return i.default.replace(`___class${i.default.repeat("_",n>0?n:1)}#___`,"#",e)}return i.default.isNull(t)?i.default.replace("___class_#___","#",e):i.default.replace("___class_+?#___","#",e)}getTemplatingStringPlaceholder(e){return i.default.replace("___templating_str_#___","#",e)}restoreIgnoredLines(e){return i.default.replace(e,new RegExp(`${this.getIgnoredLinePlaceholder("(\\d+)")}`,"gm"),(t,r)=>this.ignoredLines[r])}restoreCurlyBraceForJS(e){return i.default.replace(e,new RegExp(`${this.getCurlyBraceForJSPlaceholder("(\\d+)")}`,"gm"),(t,r)=>`@{{ ${j.default.js_beautify(this.curlyBracesWithJSs[r].trim())} }}`)}restorePhpBlock(e){return this.restoreRawPhpBlock(e).then(t=>this.restoreRawPropsBlock(t))}async restoreRawPhpBlock(e){return i.default.replace(e,new RegExp(`^(.*?)${this.getRawPlaceholder("(\\d+)")}`,"gm"),(t,r,n)=>{let s=this.rawBlocks[n];return this.isInline(s)&&this.isMultilineStatement(s)?s=b(`<?php
${s}
?>`).trim():s.split(`
`).length>1?s=b(`<?php${s}?>`).trimRight(`
`):s=`<?php${s}?>`,i.default.replace(s,/^(\s*)?<\?php(.*?)\?>/gms,(o,h,u)=>this.isInline(s)?`${r}@php${u}@endphp`:`${i.default.isEmpty(r)?"":r}@php${this.indentRawBlock(r,u)}@endphp`)})}async restoreRawPropsBlock(e){let t=this.getRawPropsPlaceholder("(\\d+)");return i.default.replace(e,new RegExp(t,"gms"),(r,n)=>`@props(${_(this.rawPropsBlocks[n]).trimRight()})`)}isInline(e){return i.default.split(e,`
`).length===1}isMultilineStatement(e){return b(`<?php${e}?>`).trimRight().split(`
`).length>1}indentRawBlock(e,t){if(i.default.isEmpty(e))return t;if(this.isInline(t))return`${e}${t}`;let n=(0,B.default)(e).amount/this.indentSize,s=this.indentCharacter.repeat(n<0?0:(n+1)*this.indentSize),o=this.indentCharacter.repeat(n<0?0:n*this.indentSize),h=t.split(`
`);return i.default.chain(h).map((u,p)=>p===0?u.trim():p===h.length-1?o+u:s+u).join(`
`)}indentBladeDirectiveBlock(e,t){if(i.default.isEmpty(e))return t;if(this.isInline(t))return`${e}${t}`;let n=(0,B.default)(e).amount/this.indentSize,s=this.indentCharacter.repeat(n<0?0:n*this.indentSize),o=this.indentCharacter.repeat(n<0?0:n*this.indentSize),h=t.split(`
`);return i.default.chain(h).map((u,p)=>p===h.length-1?o+u:s+u).value().join(`
`)}indentScriptBlock(e,t){if(i.default.isEmpty(e))return t;if(this.isInline(t))return`${e}${t}`;let n=(0,B.default)(e).amount/this.indentSize,s=this.indentCharacter.repeat(n<0?0:n*this.indentSize),o=this.indentCharacter.repeat(n<0?0:n*this.indentSize),u=i.default.replace(t,/`.*?`/gs,m=>this.storeTemplatingString(m)).split(`
`),p=i.default.chain(u).map((m,d)=>d===u.length-1?o+m:i.default.isEmpty(m)?m:s+m).value().join(`
`);return this.restoreTemplatingString(p)}indentRawPhpBlock(e,t){if(i.default.isEmpty(e))return t;if(this.isInline(t))return`${e}${t}`;let n=(0,B.default)(e).amount/this.indentSize,s=this.indentCharacter.repeat(n<0?0:n*this.indentSize),o=t.split(`
`);return i.default.chain(o).map((h,u)=>u===0?h.trim():s+h).value().join(`
`)}restoreBladeDirectivesInScripts(e){let t=new RegExp(`^(.*?)${this.getBladeDirectivePlaceholder("(\\d+)")}`,"gm"),r=i.default.replace(e,t,(n,s,o)=>this.indentBladeDirectiveBlock(s,this.bladeDirectives[o]));return t.test(e)&&(r=this.restoreBladeDirectivesInScripts(r)),r}async formatPreservedBladeDirectives(e){return me.default.map(e,async t=>{let r=await this.formatAsHtml(t);return(await this.formatAsBlade(r)).trimRight(`
`)})}restoreBladeComment(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getBladeCommentPlaceholder("(\\d+)")}`,"gms"),(r,n)=>`{{-- ${this.bladeComments[n].trim()} --}}`))}restoreBladeBrace(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`(.*?)${this.getBladeBracePlaceholder("(\\d+)")}`,"gm"),(r,n,s)=>{let o=this.bladeBraces[s];return o.trim()===""?`${n}{{${o}}}`:this.isInline(o)?`${n}{{ ${_(o,120,!1).replace(/([\n\s]*)->([\n\s]*)/gs,"->").split(`
`).map(h=>h.trim()).join("").trimRight(`
`)} }}`:`${n}{{ ${this.indentRawPhpBlock(n,_(o).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`))} }}`}))}restoreRawBladeBrace(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getRawBladeBracePlaceholder("(\\d+)")}`,"gms"),(r,n)=>{let s=this.rawBladeBraces[n];return s.trim()===""?`{!!${s}!!}`:`{!! ${_(s).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`)} !!}`}))}restoreInlineDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getInlinePlaceholder("(\\d+)")}`,"gms"),(r,n)=>this.inlineDirectives[n]))}restoreConditions(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getConditionPlaceholder("(\\d+)")}`,"gms"),(r,n)=>{let s=this.conditions[n];return _(s).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trimEnd()}))}restoreInlinePhpDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`(.*?)${this.getInlinePhpPlaceholder("(\\d+)")}`,"gm"),(r,n,s)=>{let o=this.inlinePhpDirectives[s];return o.includes("@php")?`${n}${_(o).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`)}`:o.includes("@button")?i.default.replace(o,/@(button)(.*)/gis,(u,p,m)=>{let d=_(`func_inline_for_${p}${m}`,80,!0).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`);return this.isInline(d)?`${this.indentRawPhpBlock(n,`@${d}`.replace("func_inline_for_",""))}`:`${n}${this.indentRawPhpBlock(n,`@${d}`.replace("func_inline_for_",""))}`}):o.includes("@class")?i.default.replace(o,/@(class)(.*)/gis,(u,p,m)=>{let d=_(`func_inline_for_${p}${m}`,80,!0).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`);return this.isInline(d)?`${this.indentRawPhpBlock(n,`@${d}`.replace("func_inline_for_",""))}`:`${n}${this.indentRawPhpBlock(n,`@${d}`.replace("func_inline_for_",""))}`}):`${n}${_(o).trimEnd()}`}))}restoreRawPhpTags(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getRawPhpTagPlaceholder("(\\d+)")}`,"gms"),(r,n)=>{try{let s=b(this.rawPhpTags[n]).trim().trimRight(`
`);if(this.isInline(s))return s;let o=t.match(new RegExp(`^(\\s*?)[^\\s]*?${this.getRawPhpTagPlaceholder(n)}`,"ms"));return o?this.indentRawPhpBlock(o[1],s):s}catch{return`${this.rawPhpTags[n]}`}}))}restoreScripts(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`^(.*?)${this.getScriptPlaceholder("(\\d+)")}`,"gim"),(r,n,s)=>{let o=this.scripts[s],h={indent_size:w(this.options).indentSize||4,wrap_line_length:w(this.options).wrapLineLength||120,wrap_attributes:w(this.options).wrapAttributes||"auto",wrap_attributes_indent_size:n.length,end_with_newline:!1,templating:["php"]};return this.indentScriptBlock(n,j.default.html_beautify(o,h))}))}restoreClass(e){return i.default.replace(e,new RegExp(`${this.getClassPlaceholder("(\\d+)")}`,"gms"),(t,r)=>this.classes[r])}restoreTemplatingString(e){return i.default.replace(e,new RegExp(`${this.getTemplatingStringPlaceholder("(\\d+)")}`,"gms"),(t,r)=>this.templatingStrings[r])}async formatAsBlade(e){let t=R(e),r=await new M(this.vsctm,this.oniguruma);return r.createRegistry(e).loadGrammar("text.html.php.blade").then(o=>r.tokenizeLines(t,o)).then(o=>this.formatTokenizedLines(t,o)).catch(o=>{throw o})}formatTokenizedLines(e,t){this.result=[],this.stack=[];for(let r=0;r<e.length;r+=1){let n=e[r],s=t[r];this.processLine(s,n)}return this.result.join(ue.default.EOL)}processLine(e,t){this.processTokenizeResult(e,t)}processKeyword(e){if(i.default.includes(E,e)){if(i.default.last(this.stack)==="@case"&&e==="@case"){this.currentIndentLevel-=1;return}this.stack.push(e);return}if(i.default.includes(L,e)&&i.default.last(this.stack)!=="@hassection"){this.stack.pop();return}i.default.includes(Y,e)&&(this.shouldBeIndent=!0,this.stack.push(e)),i.default.includes(X,e)&&i.default.includes(Q,i.default.last(this.stack))&&(this.currentIndentLevel-=1,this.shouldBeIndent=!0),i.default.includes(v,e)&&(i.default.last(this.stack)==="@section"&&e==="@section"?(this.currentIndentLevel>0&&(this.currentIndentLevel-=1),this.shouldBeIndent=!0):(this.shouldBeIndent=!0,this.stack.push(e))),i.default.includes(T,e)&&(i.default.last(this.stack)==="@default"&&(this.currentIndentLevel-=1),this.currentIndentLevel-=1,this.shouldBeIndent=!1,this.stack.pop()),i.default.includes(q,e)&&(this.currentIndentLevel-=1,this.shouldBeIndent=!0)}processToken(e,t){if(i.default.includes(e.scopes,"punctuation.definition.comment.begin.blade")&&(this.isInsideCommentBlock=!0),this.argumentCheck){let{count:r,inString:n,stack:s}=this.argumentCheck;if(!n&&t===")"){if(s.push(t),r[t]+=1,r["("]===r[t]){let o=s.join("");ne(o)>=this.argumentCheck.unindentOn&&(this.shouldBeIndent=!1),this.argumentCheck=!1}return}s.push(t),n===t?this.argumentCheck.inString=!1:!n&&(t==='"'||t==="'")&&(this.argumentCheck.inString=t),t==="("&&!n&&(r[t]+=1)}i.default.includes(e.scopes,"punctuation.definition.comment.end.blade")&&(this.isInsideCommentBlock=!1),(t==="{{--"||t.includes("{{--"))&&(this.isInsideCommentBlock=!0),(t==="--}}"||t.includes("--}}"))&&(this.isInsideCommentBlock=!1),!!i.default.includes(e.scopes,"keyword.blade")&&(this.isInsideCommentBlock||(this.processKeyword(t.toLowerCase()),i.default.includes(Object.keys(N),t.toLowerCase())&&(this.argumentCheck={unindentOn:N[t.toLowerCase()],stack:[],inString:!1,count:{"(":0,")":0}})))}processTokenizeResult(e,t){if(this.shouldBeIndent&&(this.currentIndentLevel+=1,this.shouldBeIndent=!1),ee(e,t)){this.insertFormattedLineToResult(t);return}for(let r=0;r<e.tokens.length;r+=1){let n=e.tokens[r],s=t.substring(n.startIndex,n.endIndex).trim();this.processToken(n,s)}this.insertFormattedLineToResult(t)}insertFormattedLineToResult(e){let r=(0,B.default)(e).amount+this.indentSize*this.currentIndentLevel,n=this.indentCharacter.repeat(r<0?0:r)+e.trimLeft();e.length===0&&this.result.push(e),e.length!==0&&n.length>0&&this.result.push(n),n!==e&&this.diffs.push({original:e,formatted:n})}};var ge=l(require("path")),fe=l(require("fs")),ye=l(require("ajv")),we=l(require("find-config")),Ke=new ye.default,_e=[".bladeformatterrc.json",".bladeformatterrc"];function ve(a){for(let e=0;e<_e.length;e+=1){let t=(0,we.default)(_e[e],{cwd:ge.default.dirname(a),home:!1});if(t)return t}return null}async function Pe(a){if(a===null)return;let e=JSON.parse((await fe.default.promises.readFile(a)).toString()),t={type:"object",properties:{indentSize:{type:"integer",nullable:!0},wrapLineLength:{type:"integer",nullable:!0},wrapAttributes:{type:"string",enum:["auto","force","force-aligned","force-expand-multiline","aligned-multiple","preserve","preserve-aligned"],nullable:!0},endWithNewline:{type:"boolean",nullable:!0},useTabs:{type:"boolean",nullable:!0}},additionalProperties:!0},r=Ke.compile(t);if(!r(e))throw r;return e}var W=class extends Error{};var S=class{constructor(e={},t=[]){this.currentTargetPath=".",this.paths=t,this.options=e,this.targetFiles=[],this.errors=[],this.diffs=[],this.outputs=[],this.formattedFiles=[],this.ignoreFile="",this.fulFillFiles=[],this.targetFiles=[],this.runtimeConfigCache={}}async format(e,t={}){let r=this.options||t;return await this.readIgnoreFile(c.default.cwd()),await this.readRuntimeConfig(c.default.cwd()),new x(r).formatContent(e).catch(n=>{throw new W(n)})}async formatFromCLI(){try{this.printPreamble(),await this.readIgnoreFile(c.default.cwd()),await this.processPaths(),this.printResults()}catch{}}fileExists(e){return $.default.promises.access(e,$.default.constants.F_OK).then(()=>!0).catch(()=>!1)}async readIgnoreFile(e){let t=".bladeignore",r,n=C.default.dirname(e);if(this.options.ignoreFilePath?r=this.options.ignoreFilePath:r=(0,$e.default)(t,{cwd:n}),!!r)try{this.ignoreFile=(await $.default.promises.readFile(r)).toString()}catch{}}async readRuntimeConfig(e){var r,n;g.default.isEmpty(this.runtimeConfigCache)&&(this.options=g.default.merge(this.options,this.runtimeConfigCache));let t;if(this.options.runtimeConfigPath?t=this.options.runtimeConfigPath:t=ve(e),!g.default.isNull(t))try{let s=await Pe(t);this.options=g.default.merge(this.options,s),this.runtimeConfigCache=this.options}catch(s){s instanceof SyntaxError&&(c.default.stdout.write(f.default.red.bold(`
Blade Formatter JSON Syntax Error: 

`)),c.default.stdout.write(U.default.format(s)),c.default.exit(1)),c.default.stdout.write(f.default.red.bold(`
Blade Formatter Config Error: ${C.default.basename(t)}

`)),c.default.stdout.write(`\`${s.errors[0].instancePath.replace("/","")}\` ${s.errors[0].message}

`),((r=s.errors[0].params)==null?void 0:r.allowedValues)&&console.log((n=s.errors[0].params)==null?void 0:n.allowedValues),c.default.exit(1)}}async processPaths(){await Promise.all(g.default.map(this.paths,async e=>this.processPath(e)))}async processPath(e){await S.globFiles(e).then(t=>g.default.map(t,r=>C.default.relative(".",r))).then(t=>this.filterFiles(t)).then(this.fulFillFiles).then(t=>this.formatFiles(t))}static globFiles(e){return new Promise((t,r)=>{(0,Be.default)(e,(n,s)=>n?r(n):t(s))})}async filterFiles(e){if(this.ignoreFile==="")return e;let t=/^\.\.*/,r=g.default.filter(e,o=>t.test(C.default.relative(".",o))),n=g.default.xor(e,r),s=(0,be.default)().add(this.ignoreFile).filter(n);return g.default.concat(r,s)}static fulFillFiles(e){return this.targetFiles.push(e),Promise.resolve(e)}async formatFiles(e){await Promise.all(g.default.map(e,async t=>this.formatFile(t)))}async formatFile(e){await this.readRuntimeConfig(e),await O(e).then(t=>Promise.resolve(t.toString("utf-8"))).then(t=>new x(this.options).formatContent(t)).then(t=>this.checkFormatted(e,t)).then(t=>this.writeToFile(e,t)).catch(t=>{this.handleError(e,t)})}async checkFormatted(e,t){this.printFormattedOutput(e,t);let r=$.default.readFileSync(e,"utf-8"),n=R(r),s=R(t),o=ie(e,n,s);return this.diffs.push(o),this.outputs.push(t),o.length>0&&((this.options.progress||this.options.write)&&c.default.stdout.write(f.default.green("F")),this.options.checkFormatted&&(c.default.stdout.write(`${e}
`),c.default.exitCode=1),this.formattedFiles.push(e)),o.length===0&&(this.options.progress||this.options.write)&&c.default.stdout.write(f.default.green(".")),Promise.resolve(t)}printFormattedOutput(e,t){this.options.write||this.options.checkFormatted||(c.default.stdout.write(`${t}`),g.default.last(this.paths)===e||g.default.last(this.targetFiles)===e)||(this.paths.length>1||this.targetFiles.length>1)&&c.default.stdout.write(`
`)}writeToFile(e,t){!this.options.write||this.options.checkFormatted||t.length===0||g.default.isNull(t)||g.default.isEmpty(t)||$.default.writeFile(e,t,r=>{r&&(c.default.stdout.write(`${f.default.red(r.message)}
`),c.default.exit(1))})}handleError(e,t){(this.options.progress||this.options.write)&&c.default.stdout.write(f.default.red("E")),c.default.exitCode=1,this.errors.push({path:e,message:t.message,error:t})}printPreamble(){this.options.checkFormatted&&c.default.stdout.write(`Check formatting... 
`)}async printResults(){this.printDescription(),this.printDifferences(),this.printFormattedFiles(),this.printErrors()}printDescription(){if(!this.options.write)return;let e=`

`;c.default.stdout.write(e),c.default.stdout.write(f.default.bold.green(`Fixed: F
`)),c.default.stdout.write(f.default.bold.red(`Errors: E
`)),c.default.stdout.write(f.default.bold("Not Changed: ")+f.default.bold.green(`.
`))}printFormattedFiles(){if(this.formattedFiles.length===0){this.options.checkFormatted&&c.default.stdout.write(f.default.bold(`
All matched files are formatted! 
`));return}if(!this.options.write){this.options.checkFormatted&&c.default.stdout.write(`
Above file(s) are formattable. Forgot to run formatter? Use ${f.default.bold("--write")} option to overwrite.
`);return}c.default.stdout.write(f.default.bold(`
Formatted Files: 
`)),g.default.each(this.formattedFiles,e=>c.default.stdout.write(`${f.default.bold(e)}
`))}printDifferences(){if(!!this.options.diff){if(c.default.stdout.write(f.default.bold(`
Differences: 

`)),g.default.filter(this.diffs,e=>e.length>0).length===0){c.default.stdout.write((0,f.default)(`No changes found. 

`));return}g.default.each(this.diffs,e=>re(e))}}printErrors(){g.default.isEmpty(this.errors)||(c.default.stdout.write(f.default.red.bold(`
Errors: 

`)),g.default.each(this.errors,e=>c.default.stdout.write(`${U.default.format(e)}
`)))}};async function Ie(){let a=await(0,Se.default)((0,Fe.hideBin)(process.argv)).usage("Usage: $0 [options] [file glob | ...]").example('$0 "resources/views/**/*.blade.php" --write',"Format all files in views directory").option("check-formatted",{alias:"c",type:"boolean",description:"Only checks files are formatted or not",default:!1}).option("write",{alias:"w",type:"boolean",description:"Write to file",default:!1}).option("diff",{alias:"d",type:"boolean",description:"Show diffs",default:!1}).option("end-with-newline",{alias:"e",type:"boolean",description:"End output with newline",default:!0}).option("indent-size",{alias:"i",type:"integer",description:"Indentation size",default:4}).option("wrap-line-length",{alias:"wrap",type:"integer",description:"The length of line wrap size",default:120}).option("wrap-attributes",{alias:"wrap-atts",type:"string",description:"The way to wrap attributes",default:"auto"}).option("progress",{alias:"p",type:"boolean",description:"Print progress",default:!1}).option("stdin",{type:"boolean",description:"format code provided on <STDIN>",default:!1}).option("config",{alias:["runtimeConfigPath"],type:"string",description:"Use this configuration, overriding .bladeformatterrc config options if present",default:null}).option("ignore-path",{alias:["ignoreFilePath"],type:"string",description:"Specify path of ignore file",default:null}).help("h").alias("h","help").epilog("Copyright Shuhei Hayashibara 2019"),e=await Ce.promises.readFile(require.resolve("vscode-oniguruma/release/onig.wasm"));if(await(0,xe.loadWASM)(e.buffer),a.argv.stdin){await process.stdin.pipe((0,Re.default)({encoding:"string"},r=>new S(a.argv).format(r).then(n=>{n!==void 0&&process.stdout.write(n)}).catch(n=>{process.stdout.write(`${n.toString()}
`),process.exit(1)})));return}if(a.argv._.length===0){a.showHelp();return}await new S(a.argv,a.argv._).formatFromCLI()}module.exports=ze(Me);0&&(module.exports={});
//# sourceMappingURL=cli-bundle.js.map
